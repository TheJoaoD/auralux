# Story 4.2: Implementar Listagem de Produtos com Toggle de Visibilidade

## Status
**Draft**

## Story

**As a** gestor,
**I want** visualizar todos os produtos do estoque com toggle para ativar/desativar no catálogo público,
**so that** possa controlar quais produtos aparecem para clientes.

## Acceptance Criteria

1-2. Página /catalogo-admin/produtos com tabela: Imagem, Nome, Categoria, Preço, Estoque, Visível, Destaque, Ações
3. Toggle "Visível" atualiza catalog_items.visible
4. Toggle "Destaque" atualiza catalog_items.featured
5. Ações: Editar Detalhes, Preview
6-7. Filtro categoria + busca nome (debounce 300ms)
8. Paginação 50/página
9. Auto-criar catalog_items ao ativar produto
10-11. Optimistic update + toast
12. Badge vermelho se estoque = 0
13. Tabela ordenável
14-15. E2E: ativar/desativar reflete no público

## Tasks / Subtasks

- [ ] **Task 1: Tabela de produtos** (AC: 1-2)
  - [ ] DataTable (shadcn/ui)
  - [ ] Colunas conforme AC

- [ ] **Task 2: Toggles de visibilidade** (AC: 3-4, 9-11)
  - [ ] Switch component
  - [ ] Mutation: upsert catalog_items
  - [ ] Optimistic update

- [ ] **Task 3: Filtros e busca** (AC: 6-7)
  - [ ] Dropdown categorias
  - [ ] Input busca com debounce

- [ ] **Task 4: Paginação e sort** (AC: 8, 13)
  - [ ] Pagination component
  - [ ] Sortable columns

- [ ] **Task 5: Testes** (AC: 14-15)
  - [ ] E2E: toggle → verificar público

## Dev Notes

Auto-create catalog_items:
```typescript
async function toggleVisibility(productId: string, visible: boolean) {
  const { data, error } = await supabase
    .from('catalog_items')
    .upsert({
      product_id: productId,
      visible: visible,
      // Defaults: featured: false, etc
    }, {
      onConflict: 'product_id'
    })
}
```

**Dependencies**: Story 4.1

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-09 | v1.0 | Created | Bob (SM) |
