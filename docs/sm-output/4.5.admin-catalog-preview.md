# Story 4.5: Implementar Preview do Cat√°logo P√∫blico

## Status
**Draft**

## Story

**As a** gestor,
**I want** visualizar preview do cat√°logo p√∫blico antes de publicar mudan√ßas,
**so that** possa validar apar√™ncia e conte√∫do antes de tornar vis√≠vel aos clientes.

## Acceptance Criteria

1. Bot√£o "Preview do Cat√°logo" no header /catalogo-admin
2. Abre /catalogo em nova aba
3. Query param ?preview=true
4. Preview mostra produtos visible=false com badge "Oculto"
5. Banner topo: "üîç Modo Preview - Gestor"
6. Navega√ß√£o completa do cat√°logo
7. Favoritos/carrinho desabilitados
8. Bot√£o "Sair do Preview" ‚Üí /catalogo-admin
9. Responsivo mobile
10. E2E: gestor v√™ ocultos
11. E2E: cliente n√£o v√™ ocultos com ?preview=true

## Tasks / Subtasks

- [ ] **Task 1: Preview mode detection** (AC: 3)
  - [ ] useSearchParams() ‚Üí preview=true
  - [ ] Context para modo preview

- [ ] **Task 2: Show hidden products** (AC: 4)
  - [ ] Query inclui visible=false se preview mode
  - [ ] Badge "Oculto" em ProductCard

- [ ] **Task 3: Preview banner** (AC: 5, 8)
  - [ ] Banner fixo topo
  - [ ] Bot√£o sair preview

- [ ] **Task 4: Disable actions** (AC: 7)
  - [ ] if (isPreviewMode) disable favoritos/carrinho

- [ ] **Task 5: Access control** (AC: 11)
  - [ ] Middleware: preview=true requer auth.uid()

- [ ] **Task 6: Testes** (AC: 10-11)

## Dev Notes

Preview middleware:
```typescript
// middleware.ts
if (pathname.startsWith('/catalogo') && searchParams.get('preview') === 'true') {
  const token = request.cookies.get('sb-access-token')
  
  if (!token) {
    // Remove preview param for non-authenticated
    return NextResponse.redirect(new URL('/catalogo', request.url))
  }
}
```

**Dependencies**: Story 4.2

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-09 | v1.0 | Created | Bob (SM) |
