# Story 3.4: Implementar Formulário de Solicitação de Produtos

## Status
**Draft**

## Story

**As a** usuário do catálogo autenticado,
**I want** solicitar produtos que não estão no catálogo via formulário livre,
**so that** possa pedir itens específicos ao gestor.

## Acceptance Criteria

1-3. Página /catalogo/solicitar-produto com formulário (Nome do Produto, Observações)
4-5. Server Action createProductRequest() insere em catalog_requests
6. Toast: "Solicitação enviada! O gestor entrará em contato"
7. Redirect para /catalogo/solicitacoes
8-10. Página /catalogo/solicitacoes listando histórico com badges de status
11. Notificação real-time ao gestor
12. Link "Solicitar Produto" no footer
13. E2E: fluxo completo testado
14. Integration: RLS isolamento

## Tasks / Subtasks

- [ ] **Task 1: Formulário /catalogo/solicitar-produto** (AC: 1-4)
  - [ ] Input "Nome do Produto" (required)
  - [ ] Textarea "Observações" (optional)
  - [ ] Server Action createProductRequest()

- [ ] **Task 2: Página /catalogo/solicitacoes** (AC: 8-10)
  - [ ] Lista ordenada por data DESC
  - [ ] Badge colorido por status
  - [ ] Empty state

- [ ] **Task 3: Real-time notification** (AC: 11)
  - [ ] Trigger Supabase automático

- [ ] **Task 4: UI integration** (AC: 6-7, 12)
  - [ ] Toast sucesso
  - [ ] Redirect
  - [ ] Link no footer

- [ ] **Task 5: Testes** (AC: 13-14)
  - [ ] E2E: criar solicitação
  - [ ] RLS isolamento

## Dev Notes

**[Source: docs/architecture/database-schema-migrations.md]**

### Tabela catalog_requests:
```sql
CREATE TABLE catalog_requests (
  id UUID PRIMARY KEY,
  user_whatsapp VARCHAR(20) NOT NULL REFERENCES catalog_users(whatsapp),
  product_name TEXT NOT NULL,
  observations TEXT,
  status catalog_request_status DEFAULT 'pending',
  admin_notes TEXT,
  created_at TIMESTAMP,
  updated_at TIMESTAMP
);

CREATE TYPE catalog_request_status AS ENUM (
  'pending',
  'analyzing',
  'fulfilled',
  'unavailable'
);
```

### Status Badge Colors:
```typescript
const statusColors = {
  pending: 'bg-yellow-100 text-yellow-800',
  analyzing: 'bg-blue-100 text-blue-800',
  fulfilled: 'bg-green-100 text-green-800',
  unavailable: 'bg-gray-100 text-gray-800'
}
```

**Dependencies**: Epic 1

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-09 | v1.0 | Created | Bob (SM) |
