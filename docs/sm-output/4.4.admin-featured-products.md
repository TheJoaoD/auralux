# Story 4.4: Implementar Gestão de Produtos em Destaque com Ordenação

## Status
**Draft**

## Story

**As a** gestor,
**I want** selecionar produtos em destaque e ordenar sua exibição na home do catálogo,
**so that** possa controlar quais produtos recebem maior visibilidade.

## Acceptance Criteria

1-2. Página /catalogo-admin/destaques lista featured=true ordenado por featured_order
3. Drag-and-drop para reordenar (@dnd-kit/core)
4. Reordenar atualiza featured_order
5-7. Modal adicionar produto em destaque
8. Remover dos destaques (featured=false)
9. Limite máximo 6 produtos
10. Preview home ao lado com carrossel real-time
11. Toast ao reordenar
12. E2E: reordenar reflete no público
13. E2E: 7º produto = erro

## Tasks / Subtasks

- [ ] **Task 1: Lista drag-and-drop** (AC: 1-4, 11)
  - [ ] @dnd-kit/core setup
  - [ ] Lista ordenável
  - [ ] Mutation update featured_order

- [ ] **Task 2: Modal adicionar** (AC: 5-7)
  - [ ] Modal com busca produtos
  - [ ] Adicionar: featured=true, next featured_order

- [ ] **Task 3: Remover** (AC: 8)
  - [ ] Button X → featured=false

- [ ] **Task 4: Limite 6** (AC: 9)
  - [ ] Client validation
  - [ ] Server validation

- [ ] **Task 5: Preview real-time** (AC: 10)
  - [ ] Iframe ou componente reutilizado
  - [ ] Atualiza ao reordenar

- [ ] **Task 6: Testes** (AC: 12-13)

## Dev Notes

DnD update:
```typescript
async function handleDragEnd(event) {
  const { active, over } = event
  
  if (active.id !== over.id) {
    const oldIndex = items.findIndex(i => i.id === active.id)
    const newIndex = items.findIndex(i => i.id === over.id)
    
    const newItems = arrayMove(items, oldIndex, newIndex)
    
    // Update featured_order for all items
    await Promise.all(
      newItems.map((item, index) => 
        supabase
          .from('catalog_items')
          .update({ featured_order: index })
          .eq('id', item.id)
      )
    )
  }
}
```

**Dependencies**: Story 4.2

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-09 | v1.0 | Created | Bob (SM) |
