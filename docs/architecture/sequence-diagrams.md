# Sequence Diagrams

## 1. Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client â”‚         â”‚AuthModal â”‚         â”‚Server Actionâ”‚         â”‚ Database â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
    â”‚                   â”‚                       â”‚                     â”‚
    â”‚ Click "Favoritar" â”‚                       â”‚                     â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                       â”‚                     â”‚
    â”‚                   â”‚                       â”‚                     â”‚
    â”‚         Show modal with WhatsApp input    â”‚                     â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚                     â”‚
    â”‚                   â”‚                       â”‚                     â”‚
    â”‚ Enter WhatsApp    â”‚                       â”‚                     â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                       â”‚                     â”‚
    â”‚                   â”‚                       â”‚                     â”‚
    â”‚                   â”‚ authenticateWithWhatsApp(whatsapp)          â”‚
    â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚
    â”‚                   â”‚                       â”‚                     â”‚
    â”‚                   â”‚                       â”‚ SELECT from         â”‚
    â”‚                   â”‚                       â”‚ catalog_users       â”‚
    â”‚                   â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚                   â”‚                       â”‚                     â”‚
    â”‚                   â”‚                       â”‚ User not found      â”‚
    â”‚                   â”‚                       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                   â”‚                       â”‚                     â”‚
    â”‚                   â”‚ {requiresName: true}  â”‚                     â”‚
    â”‚                   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
    â”‚                   â”‚                       â”‚                     â”‚
    â”‚       Show name input field               â”‚                     â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚                     â”‚
    â”‚                   â”‚                       â”‚                     â”‚
    â”‚ Enter name        â”‚                       â”‚                     â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                       â”‚                     â”‚
    â”‚                   â”‚                       â”‚                     â”‚
    â”‚                   â”‚ authenticateWithWhatsApp(whatsapp, name)    â”‚
    â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚
    â”‚                   â”‚                       â”‚                     â”‚
    â”‚                   â”‚                       â”‚ INSERT into         â”‚
    â”‚                   â”‚                       â”‚ catalog_users       â”‚
    â”‚                   â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚                   â”‚                       â”‚                     â”‚
    â”‚                   â”‚                       â”‚ User created        â”‚
    â”‚                   â”‚                       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                   â”‚                       â”‚                     â”‚
    â”‚                   â”‚                       â”‚ Generate JWT        â”‚
    â”‚                   â”‚                       â”‚ Set cookie          â”‚
    â”‚                   â”‚                       â”‚                     â”‚
    â”‚                   â”‚ {success: true, user} â”‚                     â”‚
    â”‚                   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
    â”‚                   â”‚                       â”‚                     â”‚
    â”‚       Close modal, update auth state      â”‚                     â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚                     â”‚
    â”‚                   â”‚                       â”‚                     â”‚
```

## 2. Cart Checkout Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client â”‚    â”‚Cart Pageâ”‚    â”‚ Server Actionâ”‚    â”‚ Database â”‚    â”‚WhatsApp â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”‚              â”‚                 â”‚                 â”‚               â”‚
    â”‚ Click        â”‚                 â”‚                 â”‚               â”‚
    â”‚ "Finalizar"  â”‚                 â”‚                 â”‚               â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚                 â”‚               â”‚
    â”‚              â”‚                 â”‚                 â”‚               â”‚
    â”‚              â”‚ generateWhatsAppMessage(cart)     â”‚               â”‚
    â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚               â”‚
    â”‚              â”‚                 â”‚                 â”‚               â”‚
    â”‚              â”‚                 â”‚ Format message  â”‚               â”‚
    â”‚              â”‚                 â”‚ with products   â”‚               â”‚
    â”‚              â”‚                 â”‚                 â”‚               â”‚
    â”‚              â”‚ message string  â”‚                 â”‚               â”‚
    â”‚              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚               â”‚
    â”‚              â”‚                 â”‚                 â”‚               â”‚
    â”‚    Show confirmation modal     â”‚                 â”‚               â”‚
    â”‚    with preview                â”‚                 â”‚               â”‚
    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚                 â”‚               â”‚
    â”‚              â”‚                 â”‚                 â”‚               â”‚
    â”‚ Confirm      â”‚                 â”‚                 â”‚               â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚                 â”‚               â”‚
    â”‚              â”‚                 â”‚                 â”‚               â”‚
    â”‚              â”‚ createOrder(cart, user)           â”‚               â”‚
    â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚               â”‚
    â”‚              â”‚                 â”‚                 â”‚               â”‚
    â”‚              â”‚                 â”‚ INSERT into     â”‚               â”‚
    â”‚              â”‚                 â”‚ catalog_orders  â”‚               â”‚
    â”‚              â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚
    â”‚              â”‚                 â”‚                 â”‚               â”‚
    â”‚              â”‚                 â”‚ âš¡ TRIGGER      â”‚               â”‚
    â”‚              â”‚                 â”‚ after_insert    â”‚               â”‚
    â”‚              â”‚                 â”‚ fires           â”‚               â”‚
    â”‚              â”‚                 â”‚                 â”‚               â”‚
    â”‚              â”‚                 â”‚ ğŸ“¡ Realtime     â”‚               â”‚
    â”‚              â”‚                 â”‚ broadcast       â”‚               â”‚
    â”‚              â”‚                 â”‚ (to admin)      â”‚               â”‚
    â”‚              â”‚                 â”‚                 â”‚               â”‚
    â”‚              â”‚ {success, orderId}                â”‚               â”‚
    â”‚              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚               â”‚
    â”‚              â”‚                 â”‚                 â”‚               â”‚
    â”‚              â”‚ clearCart(user) â”‚                 ï¿½ï¿½               â”‚
    â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚               â”‚
    â”‚              â”‚                 â”‚                 â”‚               â”‚
    â”‚              â”‚                 â”‚ DELETE from     â”‚               â”‚
    â”‚              â”‚                 â”‚ catalog_cart    â”‚               â”‚
    â”‚              â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚
    â”‚              â”‚                 â”‚                 â”‚               â”‚
    â”‚              â”‚ Open WhatsApp   â”‚                 â”‚               â”‚
    â”‚              â”‚ deep link       â”‚                 â”‚               â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
    â”‚              â”‚                 â”‚                 â”‚               â”‚
    â”‚              â”‚                 â”‚                 â”‚  Message      â”‚
    â”‚              â”‚                 â”‚                 â”‚  pre-filled   â”‚
    â”‚              â”‚                 â”‚                 â”‚               â”‚
```

## 3. Real-time Notification Flow (Admin)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚    â”‚ Database â”‚    â”‚  Trigger â”‚    â”‚Admin Panel â”‚
â”‚(Catalog)â”‚    â”‚          â”‚    â”‚          â”‚    â”‚(Subscribed)â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     â”‚              â”‚               â”‚                 â”‚
     â”‚ Create       â”‚               â”‚                 â”‚
     â”‚ Request      â”‚               â”‚                 â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚                 â”‚
     â”‚              â”‚               â”‚                 â”‚
     â”‚              â”‚ INSERT into   â”‚                 â”‚
     â”‚              â”‚ catalog_      â”‚                 â”‚
     â”‚              â”‚ requests      â”‚                 â”‚
     â”‚              â”‚               â”‚                 â”‚
     â”‚              â”‚ âš¡ AFTER      â”‚                 â”‚
     â”‚              â”‚ INSERT        â”‚                 â”‚
     â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚
     â”‚              â”‚               â”‚                 â”‚
     â”‚              â”‚               â”‚ Execute         â”‚
     â”‚              â”‚               â”‚ notify_catalog_ â”‚
     â”‚              â”‚               â”‚ request()       â”‚
     â”‚              â”‚               â”‚                 â”‚
     â”‚              â”‚               â”‚ pg_notify()     â”‚
     â”‚              â”‚               â”‚ 'catalog_       â”‚
     â”‚              â”‚               â”‚ requests'       â”‚
     â”‚              â”‚               â”‚                 â”‚
     â”‚              â”‚               â”‚ ğŸ“¡ WebSocket    â”‚
     â”‚              â”‚               â”‚ Broadcast       â”‚
     â”‚              â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
     â”‚              â”‚               â”‚                 â”‚
     â”‚              â”‚               â”‚          ğŸ”” Notification
     â”‚              â”‚               â”‚          appears
     â”‚              â”‚               â”‚          Badge +1
     â”‚              â”‚               â”‚          Toast shown
     â”‚              â”‚               â”‚                 â”‚
```

---
