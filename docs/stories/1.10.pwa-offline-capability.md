# Story 1.10: PWA Offline Capability & Service Worker

## Status
**Draft**

## Story

**As a** store owner,
**I want** the application to work offline with cached data and queue operations for later sync,
**so that** I can continue working even with poor or no internet connectivity.

## Acceptance Criteria

1. Service worker implemented for offline caching
2. App shell cached (HTML, CSS, JS, critical assets)
3. API responses cached with stale-while-revalidate strategy
4. Images cached on first load
5. Offline fallback UI displays when no connection
6. Queue for offline operations (create customer, create product, create sale)
7. Auto-sync queued operations when connection restored
8. Online/offline status indicator in UI
9. User notified when operations are queued vs synced
10. Cache versioning for updates
11. Background sync for queued operations
12. Graceful degradation (read-only mode when offline)

## Tasks / Subtasks

- [ ] **Task 1:** Configure service worker (use next-pwa or Workbox)
- [ ] **Task 2:** Implement caching strategies (app shell, API, images)
- [ ] **Task 3:** Create offline operation queue (IndexedDB)
- [ ] **Task 4:** Build background sync handler
- [ ] **Task 5:** Add online/offline UI indicator
- [ ] **Task 6:** Test offline scenarios

## Dev Notes

[Source: docs/epics/00-prd-core.md NFR12, CR3]
- NFR12: Application shall work offline with local caching and sync
- CR3: Must meet PWA standards for offline functionality

**Libraries:** next-pwa, Workbox, idb (IndexedDB wrapper)

**Service Worker Caching:**
- Precache: /dashboard, /customers, /inventory, /settings
- Runtime cache: API calls, images, fonts
- Strategy: NetworkFirst for API, CacheFirst for assets

**Offline Queue:**
Store in IndexedDB, sync on reconnection via Background Sync API

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-07 | v1.0 | PWA Offline Capability story | Bob (Scrum Master) |
