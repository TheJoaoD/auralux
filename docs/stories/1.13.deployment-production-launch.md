# Story 1.13: Deployment & Production Launch

## Status
**Draft**

## Story

**As a** product owner,
**I want** the application deployed to production with monitoring, documentation, and proper configuration,
**so that** the store can start using it immediately with confidence and support.

## Acceptance Criteria

1. Production Supabase project configured and migrated
2. Application deployed to hosting platform (Vercel recommended)
3. Environment variables configured for production
4. Custom domain configured with SSL/HTTPS
5. Error monitoring configured (Sentry or similar)
6. Analytics configured (privacy-focused, e.g., Vercel Analytics)
7. Performance monitoring dashboard set up
8. User documentation/guide created
9. Deployment documentation updated
10. Database backups configured
11. CI/CD pipeline configured for automated deployments
12. Production smoke tests passed
13. Rollback plan documented
14. Support channels established

## Tasks / Subtasks

- [ ] **Task 1: Production Supabase Setup** (AC: 1, 10)
  - [ ] Create production Supabase project
  - [ ] Run all migrations (001_initial_schema.sql, etc.)
  - [ ] Verify all tables, views, triggers, RLS policies created
  - [ ] Create 'products' storage bucket with RLS
  - [ ] Configure database backups (daily, retain 7 days minimum)
  - [ ] Configure Point-in-Time Recovery (PITR) if available
  - [ ] Test database connection from local environment
  - [ ] Document Supabase project credentials securely

- [ ] **Task 2: Environment Variables Configuration** (AC: 3)
  - [ ] Create `.env.production` file (DO NOT commit to git)
  - [ ] Configure production environment variables:
    ```
    NEXT_PUBLIC_SUPABASE_URL=https://[prod-project].supabase.co
    NEXT_PUBLIC_SUPABASE_ANON_KEY=[prod-anon-key]
    SUPABASE_SERVICE_ROLE_KEY=[prod-service-key]
    SENTRY_DSN=[sentry-dsn]
    NEXT_PUBLIC_APP_URL=https://auralux.app
    ```
  - [ ] Add environment variables to hosting platform (Vercel)
  - [ ] Verify no secrets in source code
  - [ ] Document environment variables in deployment guide

- [ ] **Task 3: Vercel Deployment** (AC: 2, 4, 11)
  - [ ] Connect GitHub repository to Vercel
  - [ ] Configure build settings:
    - Framework: Next.js
    - Build command: `pnpm build`
    - Output directory: `.next`
    - Install command: `pnpm install`
  - [ ] Configure custom domain (e.g., auralux.app)
  - [ ] Enable automatic SSL/HTTPS (Vercel handles this)
  - [ ] Configure CI/CD:
    - Auto-deploy on push to `main` branch
    - Preview deployments for PRs
    - Run tests before deploy
  - [ ] Set up production and preview environments
  - [ ] Test deployment: Push to main â†’ Verify auto-deploy

- [ ] **Task 4: Error Monitoring with Sentry** (AC: 5)
  - [ ] Create Sentry account and project
  - [ ] Install Sentry SDK: `pnpm add @sentry/nextjs`
  - [ ] Configure `sentry.client.config.ts` and `sentry.server.config.ts`
  - [ ] Add SENTRY_DSN to environment variables
  - [ ] Configure error sampling (100% for MVP, adjust later)
  - [ ] Test error capture (throw test error in dev, verify in Sentry)
  - [ ] Set up alerts for critical errors (email, Slack)
  - [ ] Configure source maps upload for better stack traces

- [ ] **Task 5: Analytics Configuration** (AC: 6)
  - [ ] Enable Vercel Analytics (built-in, privacy-focused)
  - [ ] Configure Web Vitals tracking
  - [ ] (Optional) Add privacy-focused analytics (Plausible, Fathom)
  - [ ] Track key events:
    - Page views
    - Sale creation
    - Customer registration
    - Product creation
  - [ ] Ensure GDPR/privacy compliance (no personal data tracking)
  - [ ] Document analytics setup

- [ ] **Task 6: Performance Monitoring** (AC: 7)
  - [ ] Enable Vercel Speed Insights
  - [ ] Set up performance budgets:
    - First Contentful Paint (FCP): <2s
    - Time to Interactive (TTI): <3s
    - Lighthouse score: >90
  - [ ] Monitor Core Web Vitals (LCP, FID, CLS)
  - [ ] Set up alerts for performance degradation
  - [ ] Document performance baselines

- [ ] **Task 7: User Documentation** (AC: 8)
  - [ ] Create user guide: `docs/user-guide.md`
  - [ ] Document key workflows:
    - How to create a sale
    - How to register customers
    - How to manage inventory
    - How to view dashboard metrics
    - How to configure categories
  - [ ] Include screenshots for each workflow
  - [ ] Create FAQ section
  - [ ] Add troubleshooting guide
  - [ ] (Optional) Create video tutorial

- [ ] **Task 8: Deployment Documentation** (AC: 9)
  - [ ] Update `docs/deployment.md` with:
    - Prerequisites (accounts, tools)
    - Step-by-step deployment instructions
    - Environment variable setup
    - Database migration process
    - Rollback procedure
    - Common issues and solutions
  - [ ] Document CI/CD pipeline
  - [ ] Document monitoring dashboards
  - [ ] Include architecture diagrams

- [ ] **Task 9: Production Smoke Tests** (AC: 12)
  - [ ] Create smoke test checklist:
    - [ ] App loads successfully
    - [ ] Login works
    - [ ] Dashboard displays
    - [ ] Create customer works
    - [ ] Create product works (with image upload)
    - [ ] Create sale works (all payment methods)
    - [ ] Inventory updates after sale
    - [ ] Customer metrics update
    - [ ] Real-time updates work
    - [ ] PWA installable on iOS
    - [ ] Offline mode works
  - [ ] Run smoke tests on production
  - [ ] Fix any issues found
  - [ ] Document smoke test results

- [ ] **Task 10: Rollback Plan** (AC: 13)
  - [ ] Document rollback procedure:
    - Revert to previous Vercel deployment (one-click)
    - Database rollback (restore from backup)
    - Environment variable rollback
  - [ ] Test rollback in staging environment
  - [ ] Document when to rollback (critical bugs, data corruption)
  - [ ] Establish rollback decision process

- [ ] **Task 11: Support Channels** (AC: 14)
  - [ ] Set up support email (e.g., support@auralux.app)
  - [ ] Create issue tracking system (GitHub Issues or similar)
  - [ ] Document support SLA (response time, resolution time)
  - [ ] Create internal runbook for common issues
  - [ ] (Optional) Set up status page for uptime monitoring

- [ ] **Task 12: Final Pre-Launch Checklist**
  - [ ] All tests passing (unit, integration, E2E)
  - [ ] Code review completed
  - [ ] Security audit passed (RLS, auth, input validation)
  - [ ] Performance benchmarks met
  - [ ] Accessibility audit passed
  - [ ] User documentation complete
  - [ ] Deployment documentation complete
  - [ ] Monitoring configured and tested
  - [ ] Backups configured and tested
  - [ ] Domain and SSL working
  - [ ] Smoke tests passed in production
  - [ ] Rollback plan documented
  - [ ] Support channels ready
  - [ ] **GO LIVE! ðŸš€**

- [ ] **Task 13: Post-Launch Monitoring** (First 48 hours)
  - [ ] Monitor Sentry for errors (check every 4 hours)
  - [ ] Monitor performance metrics
  - [ ] Monitor user feedback
  - [ ] Check database performance
  - [ ] Verify backups running
  - [ ] Document any issues and resolutions
  - [ ] Create post-launch report

## Dev Notes

[Source: docs/epics/epic-01-mvp.md Story 1.15]
Story 1.15 in original epic: Deployment and Production Launch

### Deployment Platform
[Source: docs/architecture/01-tech-stack.md]
- **Platform:** Vercel (Native Next.js support, automatic previews, edge network)
- **Alternative:** Netlify, Cloudflare Pages (if Vercel not available)

**Vercel Benefits:**
- Zero-config Next.js deployment
- Automatic HTTPS
- Global CDN
- Serverless functions (Next.js API routes)
- Preview deployments for PRs
- Built-in analytics and monitoring

### Database Configuration
[Source: docs/architecture/06-infrastructure.md]
- **Production Database:** Supabase (managed PostgreSQL)
- **Backups:** Daily automated backups, retain 7 days minimum
- **PITR:** Point-in-Time Recovery for critical data
- **Monitoring:** Supabase Dashboard for query performance

### Error Monitoring
[Source: docs/architecture/01-tech-stack.md]
- **Tool:** Sentry 7.x
- **Features:**
  - Error capture with stack traces
  - User context tracking
  - Performance monitoring
  - Release tracking
  - Alerts (email, Slack)

### Environment Variables Security
**CRITICAL:** Never commit secrets to git!
- Use `.env.local` for local development (gitignored)
- Use Vercel dashboard for production env vars
- Rotate service role keys regularly
- Use different keys for prod vs staging

### CI/CD Pipeline
```yaml
# .github/workflows/deploy.yml
name: Deploy to Production
on:
  push:
    branches: [main]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: pnpm/action-setup@v2
      - run: pnpm install
      - run: pnpm test
      - run: pnpm build
  deploy:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - uses: amondnet/vercel-action@v20
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.ORG_ID }}
          vercel-project-id: ${{ secrets.PROJECT_ID }}
          vercel-args: '--prod'
```

### Performance Monitoring
**Key Metrics to Track:**
- Lighthouse Score: >90
- First Contentful Paint: <2s
- Largest Contentful Paint: <2.5s
- Time to Interactive: <3s
- Cumulative Layout Shift: <0.1

### Smoke Test Checklist (Production)
1. Load app â†’ Dashboard appears
2. Login â†’ Success
3. Create Customer â†’ Appears in list
4. Create Product â†’ Appears in gallery
5. Create Sale (PIX) â†’ Dashboard updates
6. Create Sale (Installment) â†’ Discount calculated
7. Inventory decrements after sale
8. Customer purchase count increments
9. Real-time updates work (open in 2 tabs)
10. PWA installable on iOS Safari
11. Offline mode works (disable network, browse app)
12. Error monitoring captures errors (test error)

### Rollback Procedure
**When to Rollback:**
- Critical bug affecting all users
- Data corruption or loss
- Security vulnerability discovered
- Performance degradation >50%

**How to Rollback:**
1. Vercel: Promote previous deployment to production (one-click)
2. Database: Restore from backup (Supabase Dashboard)
3. Verify rollback successful
4. Notify users of issue and resolution

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-07 | v1.0 | Deployment & Production Launch story | Bob (Scrum Master) |

---

## Dev Agent Record
*This section will be populated by the development agent during implementation.*

---

## QA Results
*This section will be populated by the QA Agent after implementation.*
