# Story 1.2: Login Screen, Bottom Navigation & Layout Structure

## Status
**Draft**

## Story

**As a** store owner,
**I want** to log in securely via an attractive login screen and navigate between main sections using a fixed bottom navigation,
**so that** I can access the application securely and move efficiently between Customers, Sales, and Inventory sections.

## Acceptance Criteria

1. Attractive login screen implemented with Auralux branding and color scheme
2. Email/password login form with Supabase Auth integration
3. Login error handling and user feedback
4. Session persistence after successful login
5. Protected route implementation (redirect to login if unauthenticated)
6. Fixed bottom navigation bar with 3 tabs (Customers, Sales, Inventory)
7. Sales tab is active/default on app load after login
8. Top bar with Auralux logo and settings icon on all screens
9. Navigation icons use Lucide React with Auralux color scheme
10. Active tab highlighting with Rosa Queimado accent
11. Touch-optimized navigation (minimum 44x44pt touch targets)
12. Smooth transitions between sections
13. Logout functionality accessible from settings
14. Responsive design for iOS devices (iPhone SE to Pro Max)

## Tasks / Subtasks

- [ ] **Task 1: Login Screen Implementation** (AC: 1, 2, 3, 4)
  - [ ] Create `app/login/page.tsx` login route
  - [ ] Design login form layout with Auralux branding:
    - Background: Carvão (#202020)
    - Auralux logo at top (from logos.md main_logo URL)
    - Card container: Taupe/Greige (#A1887F) background
    - Input fields: Areia (#E0DCD1) text, Rosa Queimado focus ring
    - Primary button: Rosa Queimado (#C49A9A) background
  - [ ] Create form with email and password fields using shadcn/ui Input component
  - [ ] Implement form validation using React Hook Form + Zod:
    - Email: required, valid email format
    - Password: required, minimum 8 characters
  - [ ] Add "Entrar" (Login) button with loading state
  - [ ] Integrate Supabase Auth signInWithPassword method
  - [ ] Handle auth errors and display user-friendly messages:
    - Invalid credentials → "Email ou senha incorretos"
    - Network error → "Erro de conexão. Tente novamente"
    - Generic error → "Erro ao fazer login. Tente novamente"
  - [ ] Use sonner toast notifications for error feedback
  - [ ] Redirect to /dashboard (Sales) on successful login
  - [ ] Show loading spinner during authentication

- [ ] **Task 2: Protected Routes & Session Management** (AC: 4, 5)
  - [ ] Create `middleware.ts` in project root for route protection
  - [ ] Check Supabase session in middleware
  - [ ] Redirect unauthenticated users to /login
  - [ ] Protect routes: /dashboard, /customers, /inventory, /settings
  - [ ] Allow public access to: /login, /signup (future)
  - [ ] Handle session refresh automatically via Supabase client
  - [ ] Test session persistence across page refreshes
  - [ ] Test redirect behavior for authenticated vs unauthenticated users

- [ ] **Task 3: Bottom Navigation Bar** (AC: 6, 7, 9, 10, 11, 12)
  - [ ] Create `components/layout/BottomNav.tsx` component
  - [ ] Import Lucide React icons:
    - Users icon for Customers tab
    - LayoutDashboard icon for Sales tab
    - Package icon for Inventory tab
  - [ ] Create navigation structure with Next.js Link components:
    - Customers: /customers
    - Sales (default): /dashboard
    - Inventory: /inventory
  - [ ] Implement fixed positioning (bottom: 0, z-index high)
  - [ ] Style navigation with Auralux color scheme:
    - Background: Taupe/Greige (#A1887F)
    - Inactive icons/text: Areia (#E0DCD1) with opacity
    - Active icons/text: Rosa Queimado (#C49A9A)
    - Active indicator: Rosa Queimado border or background
  - [ ] Ensure touch targets are minimum 44x44pt
  - [ ] Use usePathname() hook to determine active tab
  - [ ] Add smooth CSS transitions for tab changes (150ms)
  - [ ] Make Sales tab active by default on initial load
  - [ ] Add bottom padding to main content to prevent overlap
  - [ ] Test navigation on different iOS screen sizes

- [ ] **Task 4: Top Bar Component** (AC: 8, 13)
  - [ ] Create `components/layout/TopBar.tsx` component
  - [ ] Display Auralux logo (from logos.md - use main or purple logo)
  - [ ] Add Settings icon (Lucide Settings icon) on the right
  - [ ] Link Settings icon to /settings route
  - [ ] Style with Auralux color scheme:
    - Background: Carvão (#202020)
    - Logo: Prata (#BDBDBD) tint if needed
    - Settings icon: Areia (#E0DCD1)
  - [ ] Make fixed position (top: 0, z-index high)
  - [ ] Add subtle shadow for depth
  - [ ] Ensure proper spacing and alignment

- [ ] **Task 5: Main Layout Structure** (AC: 14)
  - [ ] Create `components/layout/MainLayout.tsx` wrapper component
  - [ ] Structure: TopBar + Content Area + BottomNav
  - [ ] Add proper padding to content area (top for TopBar, bottom for BottomNav)
  - [ ] Make layout responsive across iOS device sizes:
    - iPhone SE (375px width)
    - iPhone 13/14 (390px width)
    - iPhone Pro Max (428px width)
  - [ ] Use MainLayout in protected route pages
  - [ ] Add safe area insets for iOS notch handling:
    - Use `env(safe-area-inset-top)` for top padding
    - Use `env(safe-area-inset-bottom)` for bottom padding
  - [ ] Test layout on iOS Safari and PWA installed mode

- [ ] **Task 6: Settings Page with Logout** (AC: 13)
  - [ ] Create `app/settings/page.tsx` route
  - [ ] Add page title "Configurações"
  - [ ] Create "Sair" (Logout) button with logout icon
  - [ ] Implement logout functionality:
    - Call Supabase auth.signOut()
    - Clear local state
    - Redirect to /login
    - Show confirmation toast "Você saiu com sucesso"
  - [ ] Add future settings placeholders (categories, thresholds, etc.)
  - [ ] Style with Auralux color scheme

- [ ] **Task 7: Empty State Pages for Sections** (AC: 7, 12)
  - [ ] Create `app/dashboard/page.tsx` (Sales - default landing)
    - Show "Sales Dashboard" title
    - Add placeholder message: "Dashboard em construção"
    - Use MainLayout wrapper
  - [ ] Create `app/customers/page.tsx`
    - Show "Clientes" title
    - Add placeholder message: "Lista de clientes em breve"
    - Use MainLayout wrapper
  - [ ] Create `app/inventory/page.tsx`
    - Show "Estoque" title
    - Add placeholder message: "Gestão de estoque em breve"
    - Use MainLayout wrapper
  - [ ] Verify smooth transitions when navigating between sections

- [ ] **Task 8: Testing & Verification** (AC: All)
  - [ ] Test login flow with valid credentials
  - [ ] Test login flow with invalid credentials
  - [ ] Test protected route redirect behavior
  - [ ] Test session persistence after page refresh
  - [ ] Test bottom navigation on all screen sizes
  - [ ] Test active tab highlighting
  - [ ] Test logout functionality
  - [ ] Verify touch target sizes (minimum 44x44pt)
  - [ ] Test on iOS Safari and installed PWA mode
  - [ ] Write unit tests for login form validation
  - [ ] Write integration tests for auth flow
  - [ ] Document any issues or deviations

## Dev Notes

### Authentication Flow
[Source: docs/architecture/00-overview.md]
```
User → Login Screen (Supabase Auth)
     → JWT Token stored in cookies
     → Next.js Middleware validates token
     → Protected routes accessible (redirect to /login if not authenticated)
     → RLS policies enforce data isolation
```

[Source: docs/epics/00-prd-core.md FR27-FR29]
- FR27: System shall provide an attractive login screen
- FR28: System shall integrate with Supabase Authentication for user login/logout
- FR29: System shall maintain user session securely and provide session management

### UI/UX Design Specifications
[Source: docs/epics/01-ui-ux-guidelines.md]

**Login Screen Design:**
- Background: Carvão (#202020) - Main app background
- Logo: Main Auralux logo from `https://pxopccvykwdzjqjodmob.supabase.co/storage/v1/object/public/auralux_images/logo_auralux_new.png`
- Card/Form container: Taupe/Greige (#A1887F)
- Input labels: Areia (#E0DCD1)
- Input focus ring: Rosa Queimado (#C49A9A)
- Primary button (Entrar): Rosa Queimado (#C49A9A) background, Carvão (#202020) text
- Error messages: Use #C76A6A (reddish tone) on Carvão background

**Bottom Navigation Design:**
- Background: Taupe/Greige (#A1887F)
- Inactive tab icon + text: Areia (#E0DCD1) at 60% opacity
- Active tab icon + text: Rosa Queimado (#C49A9A)
- Active indicator: 3px border-top in Rosa Queimado
- Icon size: 24px
- Label font size: 12px (small)
- Touch target: 44x44pt minimum per iOS HIG

**Top Bar Design:**
- Background: Carvão (#202020)
- Height: 56px + safe-area-inset-top
- Logo: Auralux logo (Prata #BDBDBD if colorized)
- Settings icon: Areia (#E0DCD1)
- Subtle shadow: rgba(0, 0, 0, 0.1)

**Navigation Tabs:**
1. Left: Clientes (Customers) - Users icon
2. Center: Vendas (Sales) - LayoutDashboard icon - **DEFAULT**
3. Right: Estoque (Inventory) - Package icon

### Component Architecture
[Source: docs/architecture/01-tech-stack.md]
- **UI Components:** shadcn/ui (60+ components pre-configured)
- **Icons:** Lucide React (tree-shakeable, consistent design)
- **Forms:** React Hook Form 7.x + Zod validation
- **Notifications:** Sonner for toast messages
- **Styling:** Tailwind CSS 4.1.9 (mobile-first, utility classes)

### Authentication Implementation
[Source: Story 1.1 Dev Notes]
- Use `useAuth` hook from `lib/hooks/useAuth.ts` (created in Story 1.1)
- Supabase client configured in `lib/supabase/client.ts` and `lib/supabase/server.ts`
- AuthContext wraps app in `app/layout.tsx`

**Supabase Auth Methods:**
```typescript
// Sign in
const { data, error } = await supabase.auth.signInWithPassword({
  email: 'user@example.com',
  password: 'password'
});

// Sign out
const { error } = await supabase.auth.signOut();

// Get session
const { data: { session } } = await supabase.auth.getSession();
```

### Middleware Configuration
[Source: docs/architecture/00-overview.md]
Next.js middleware runs on Edge Runtime to validate JWT tokens before rendering pages.

**middleware.ts Pattern:**
```typescript
import { createMiddlewareClient } from '@supabase/auth-helpers-nextjs';
import { NextResponse } from 'next/server';
import type { NextRequest } from 'next/server';

export async function middleware(req: NextRequest) {
  const res = NextResponse.next();
  const supabase = createMiddlewareClient({ req, res });

  const { data: { session } } = await supabase.auth.getSession();

  // Protected routes
  if (!session && req.nextUrl.pathname.startsWith('/dashboard')) {
    return NextResponse.redirect(new URL('/login', req.url));
  }

  // Redirect authenticated users away from login
  if (session && req.nextUrl.pathname === '/login') {
    return NextResponse.redirect(new URL('/dashboard', req.url));
  }

  return res;
}

export const config = {
  matcher: ['/((?!_next/static|_next/image|favicon.ico).*)']
};
```

### iOS-Specific Considerations
[Source: docs/epics/00-prd-core.md NFR4-NFR6]
- NFR4: Application optimized for iOS mobile devices
- NFR6: All interactive elements minimum 44x44pt touch targets (iOS HIG)
- NFR7: Visual feedback for all user interactions

**Safe Area Insets:**
```css
/* Top bar with notch support */
padding-top: max(16px, env(safe-area-inset-top));

/* Bottom nav with home indicator support */
padding-bottom: max(16px, env(safe-area-inset-bottom));
```

**iOS PWA Viewport:**
```html
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
```

### Routing Structure
[Source: docs/architecture/08-source-tree.md]
```
app/
  login/
    page.tsx              # Login screen
  dashboard/
    page.tsx              # Sales dashboard (default landing)
  customers/
    page.tsx              # Customers list
  inventory/
    page.tsx              # Inventory list
  settings/
    page.tsx              # Settings & logout
  layout.tsx              # Root layout with AuthContext
  middleware.ts           # Route protection

components/
  layout/
    MainLayout.tsx        # Main app layout wrapper
    TopBar.tsx            # Top bar with logo and settings
    BottomNav.tsx         # Bottom navigation tabs
```

### Form Validation Schema
**Login Form Zod Schema:**
```typescript
import { z } from 'zod';

export const loginSchema = z.object({
  email: z
    .string()
    .min(1, 'Email é obrigatório')
    .email('Email inválido'),
  password: z
    .string()
    .min(8, 'Senha deve ter no mínimo 8 caracteres')
});

export type LoginFormData = z.infer<typeof loginSchema>;
```

### Error Handling
[Source: docs/architecture/09-coding-standards.md]
- Use try-catch for async operations
- Display user-friendly error messages via toast notifications
- Log errors for debugging (dev mode only, never console.log in production)
- Provide retry options for network failures

**Error Message Mapping:**
```typescript
const AUTH_ERROR_MESSAGES = {
  'Invalid login credentials': 'Email ou senha incorretos',
  'Email not confirmed': 'Confirme seu email antes de fazer login',
  'Too many requests': 'Muitas tentativas. Aguarde alguns minutos',
  default: 'Erro ao fazer login. Tente novamente'
};
```

### Testing

[Source: docs/architecture/09-coding-standards.md lines 2089-2122]

**Test Files:**
```
__tests__/
  unit/
    components/
      layout/
        BottomNav.test.tsx
        TopBar.test.tsx
    pages/
      login.test.tsx
  integration/
    auth/
      login-flow.test.ts
      protected-routes.test.ts
  e2e/
    auth-flow.spec.ts
```

**Unit Tests Required:**
1. Login form validation (Zod schema)
2. BottomNav active tab logic
3. TopBar rendering with correct links
4. MainLayout structure and spacing

**Integration Tests Required:**
1. Login flow with valid credentials
2. Login flow with invalid credentials
3. Protected route redirect behavior
4. Session persistence after page refresh
5. Logout flow

**E2E Tests Required:**
1. Complete login → navigation → logout flow
2. Protected route access without auth
3. Tab navigation and active state

**Test Coverage Goal:** 80% for authentication logic, 70% for UI components

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-07 | v1.0 | Initial story creation for Login, Navigation & Layout | Bob (Scrum Master) |

---

## Dev Agent Record

*This section will be populated by the development agent during implementation.*

---

## QA Results

*This section will be populated by the QA Agent after implementation.*
